---

- name: Configure a system to run lm-sensors config on hardware but not VMs
  hosts: 127.0.0.1
  connection: local
  become: true

  tasks:

    - name: Copy the one-shot systemd service into place
      ansible.builtin.copy:
        src: "files/oneshot-lm-sensors.conf"
        dest: "/etc/systemd/system/oneshot-lm-sensors.conf"

    # Note: This is a one-shot service that should only run once
    # when on physical hardware (will not run in a VM). After it has
    # run successfully, it will not run again
    - name: Start and enable the one-shot service to configure lm-sensors
      ansible.builtin.service:
        name: oneshot-lm-sensors
        state: started
        enabled: yes
